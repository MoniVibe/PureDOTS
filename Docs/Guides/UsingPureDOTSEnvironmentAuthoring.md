# Using Meta Registry Authoring

## Overview

Phase 2 adds authoring components that drive the new meta registries:

- `FactionAuthoring` + `FactionProfileAsset`
- `ClimateHazardAuthoring` + `ClimateHazardProfileAsset`
- `AreaEffectAuthoring` + `AreaEffectProfileAsset`
- `CultureAuthoring` + `CultureProfileAsset`

All components live under `Packages/com.moni.puredots/Runtime/Authoring/Meta`. They convert authoring data into the runtime components defined in `MetaRegistryStubs.cs`, enabling designers to seed registries directly from scenes.

## Creating Authoring Components

1. Add the desired component to a GameObject inside a SubScene.
2. Optional: assign a profile asset to pre-fill default values.
3. Adjust overrides (identity, cadence, strength, etc.) as needed.
4. Enable **Add Spatial Indexed Tag** when the entity should participate in spatial queries.
5. Bake/SubScene -> the baker writes DOTS components (`FactionId`, `FactionState`, etc.) that the registry systems consume.

| Component | Key Fields | Notes |
|-----------|------------|-------|
| `FactionAuthoring` | Faction Id/Name, Population, Diplomatic Flags | Adds `SpatialIndexedTag` by default. Use `DiplomaticStatusFlags` to signal alliances/hostility. |
| `ClimateHazardAuthoring` | Hazard Type, Radius, Intensity, Duration | Uses `EnvironmentChannelMask` to declare which environment grids are affected. |
| `AreaEffectAuthoring` | Effect Type, Strength, Radius, Owner | Supports optional owner linkage and target masks (`AreaEffectTargetMask`). |
| `CultureAuthoring` | Culture Type, Alignment, Member Count | Useful for regional alignment overlays; `addSpatialIndexedTag` is opt-in. |

## Profile Assets

Each authoring component can pull data from a ScriptableObject profile. Profiles live under **Create ➜ PureDOTS ➜ Meta Registries/**. Assign a profile and enable *Apply Profile On Validate* to copy the defaults into the component for further tweaking.

Profiles expose strongly-typed enums:

- `FactionType`, `DiplomaticStatusFlags`
- `ClimateHazardType`, `EnvironmentChannelMask`
- `AreaEffectType`, `AreaEffectTargetMask`
- `CultureType`, `CultureAlignmentFlags`

## Sample Asset Generation

Use **PureDOTS ➜ Samples ➜ Create Meta Registry Samples** to generate example assets:

- Sample profiles for each meta registry.
- A scene spawn profile (`MetaRegistrySceneSpawnProfile.asset`) with entries for the new `SceneSpawnCategory` values (Faction, ClimateHazard, AreaEffect, Culture).

Assets are created under `Assets/Samples/PureDOTS/MetaRegistries`. The scene spawn profile is intentionally prefab-agnostic—assign your own prefabs that include the new authoring components.

## Scene Spawn Integration

`SceneSpawnCategory` now includes the meta registries. Spawn entries can be tagged with `Faction`, `ClimateHazard`, `AreaEffect`, or `Culture`. The spawn system will instantiate prefabs and any attached authoring components will seed the registries on bake. Use the payload fields to forward identifiers (e.g., `payloadId = "Faction:Sample"`).

## Debug & Telemetry

- Registry systems (`FactionRegistrySystem`, `ClimateHazardRegistrySystem`, `AreaEffectRegistrySystem`, `CultureAlignmentRegistrySystem`) update counts and summary data every frame.
- Debug HUD and telemetry streams will surface the new registry totals once instrumentation is enabled (see Workstream 2 tasks).

## Checklist

- [ ] Create or reuse prefabs with the appropriate authoring component.
- [ ] Optional: generate sample profiles via the PureDOTS menu.
- [ ] Use `SceneSpawnProfileAsset` entries to spawn meta entities deterministically.
- [ ] Verify registry buffers populate via `Entity Debugger` or Debug HUD overlays.

For more detail, review `Docs/DesignNotes/MetaRegistryRoadmap.md` and the sample assets generated by the menu command.


